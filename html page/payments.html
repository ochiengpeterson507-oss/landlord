<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payments - LandlordPro</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <style>
        /* Additional payment-specific styles */
        .payment-form {
            max-width: 600px;
            margin: 0 auto;
        }
        .payment-summary {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
        }
        .payment-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .payment-summary-item:last-child {
            border-bottom: none;
        }
        .payment-summary-label {
            color: #64748b;
            font-weight: 500;
        }
        .payment-summary-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #0f172a;
        }
        .payment-success {
            background: #10b981;
            color: white;
        }
        .payment-warning {
            background: #f59e0b;
            color: white;
        }
        .payment-danger {
            background: #ef4444;
            color: white;
        }
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        .action-btn {
            padding: 0.5rem;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .action-btn:hover {
            transform: translateY(-1px);
        }
        .action-btn.edit {
            background: #3b82f6;
            color: white;
        }
        .action-btn.delete {
            background: #ef4444;
            color: white;
        }
        .action-btn.view {
            background: #64748b;
            color: white;
        }
        .action-btn.reminder {
            background: #f59e0b;
            color: white;
        }
    </style>
</head>
<body class="dashboard-body">
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>üè† LandlordPro</h2>
                <button class="sidebar-close" onclick="toggleSidebar()">‚úï</button>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html">üìä Dashboard</a>
                <a href="properties.html">üè¢ Properties</a>
                <a href="tenants.html">üë• Tenants</a>
                <a href="payments.html" class="active">üí∞ Payments</a>
                <a href="maintenance.html">üîß Maintenance</a>
                <a href="#reports">üìä Reports</a>
                <a href="#settings">‚öôÔ∏è Settings</a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">üë§</div>
                    <div class="user-details">
                        <span class="user-name" id="userName">Loading...</span>
                        <span class="user-email" id="userEmail"></span>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">üö™ Logout</button>
            </div>
        </aside>

        <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>

        <main class="main-content">
            <header class="dashboard-header">
                <h1>Payments</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openPaymentModal()">
                        + Record Payment
                    </button>
                </div>
            </header>

            <!-- Payment Summary Cards -->
            <div class="stats-grid" id="payment-summary">
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-details">
                        <h3 id="total-collected">$0</h3>
                        <p>Total Collected (MTD)</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-details">
                        <h3 id="pending-amount">$0</h3>
                        <p>Pending Payments</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-details">
                        <h3 id="late-count">0</h3>
                        <p>Late Payments</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-details">
                        <h3 id="collection-rate">0%</h3>
                        <p>Collection Rate</p>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-bar">
                <div class="search-box">
                    <input type="text" id="search-payment" placeholder="Search payments by tenant or property..." onkeyup="filterPayments()">
                </div>
                <div class="filter-options">
                    <select id="status-filter" onchange="filterPayments()">
                        <option value="all">All Status</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="late">Late</option>
                        <option value="partial">Partial</option>
                    </select>
                    <select id="month-filter" onchange="filterPayments()">
                        <option value="">All Months</option>
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                    <select id="year-filter" onchange="filterPayments()">
                        <option value="">All Years</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
            </div>

            <!-- Payments Table -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h2>Payment History</h2>
                </div>
                <div class="card-content">
                    <div class="table-responsive">
                        <table class="data-table" id="payments-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Tenant</th>
                                    <th>Property</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="payments-list">
                                <tr>
                                    <td colspan="8" class="loading">Loading payments...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Record Payment Modal -->
    <div class="modal" id="payment-modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="modal-title">Record Payment</h3>
                <button class="modal-close" onclick="closePaymentModal()">‚úï</button>
            </div>
            <form id="payment-form" class="payment-form">
                <input type="hidden" id="payment-id">
                
                <div class="form-group">
                    <label for="payment-tenant">Select Tenant *</label>
                    <select id="payment-tenant" required onchange="loadTenantDetails()">
                        <option value="">-- Select a tenant --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="payment-property">Property</label>
                    <input type="text" id="payment-property" readonly class="readonly-field">
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="payment-amount">Amount ($) *</label>
                        <input type="number" id="payment-amount" min="0" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group half">
                        <label for="payment-method">Payment Method *</label>
                        <select id="payment-method" required>
                            <option value="">Select method</option>
                            <option value="cash">Cash</option>
                            <option value="check">Check</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="credit_card">Credit Card</option>
                            <option value="venmo">Venmo</option>
                            <option value="paypal">PayPal</option>
                            <option value="zelle">Zelle</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="payment-date">Payment Date *</label>
                        <input type="date" id="payment-date" required>
                    </div>
                    <div class="form-group half">
                        <label for="payment-due-date">Due Date *</label>
                        <input type="date" id="payment-due-date" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half">
                        <label for="payment-status">Status *</label>
                        <select id="payment-status" required onchange="toggleLateFee()">
                            <option value="paid">Paid</option>
                            <option value="pending">Pending</option>
                            <option value="partial">Partial</option>
                            <option value="late">Late</option>
                        </select>
                    </div>
                    <div class="form-group half" id="late-fee-group" style="display: none;">
                        <label for="payment-late-fee">Late Fee ($)</label>
                        <input type="number" id="payment-late-fee" min="0" step="0.01" value="0">
                    </div>
                </div>

                <div class="form-group">
                    <label for="payment-notes">Notes</label>
                    <textarea id="payment-notes" rows="3" placeholder="Additional notes about this payment..."></textarea>
                </div>

                <div class="form-group">
                    <label for="payment-receipt">Receipt URL (optional)</label>
                    <input type="url" id="payment-receipt" placeholder="https://example.com/receipt.pdf">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closePaymentModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="save-payment-btn">
                        <span class="btn-text">Save Payment</span>
                        <span class="btn-loader" style="display: none;">‚è≥</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Payment Modal -->
    <div class="modal" id="view-payment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Payment Details</h3>
                <button class="modal-close" onclick="closeViewModal()">‚úï</button>
            </div>
            <div class="payment-details" id="payment-details-content">
                <!-- Payment details will be loaded here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeViewModal()">Close</button>
                <button class="btn btn-primary" onclick="editPaymentFromView()">Edit</button>
                <button class="btn btn-danger" onclick="deletePaymentFromView()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="delete-modal">
        <div class="modal-content">
            <h3>Delete Payment</h3>
            <p>Are you sure you want to delete this payment record? This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Send Reminder Modal -->
    <div class="modal" id="reminder-modal">
        <div class="modal-content">
            <h3>Send Payment Reminder</h3>
            <p>Send a payment reminder to <span id="reminder-tenant-name"></span>?</p>
            <div class="form-group">
                <label for="reminder-message">Custom Message (optional)</label>
                <textarea id="reminder-message" rows="3" placeholder="Enter a custom message..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeReminderModal()">Cancel</button>
                <button class="btn btn-primary" onclick="sendReminder()">Send Reminder</button>
            </div>
        </div>
    </div>

    <script src="payments.js"></script>
</body>
</html>